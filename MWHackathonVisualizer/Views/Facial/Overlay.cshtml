@model MWHackathonHarvester.Services.Faces
@{
  Layout = null;
  MWHackathonHarvester.Services.Faces uploaded = ViewBag.Faces;
}
<style>
canvas { position:absolute;
      top:0; left:0; }
  .count {display:none;}
</style>
@*<img src="@Model.Url" id="artobject" />*@

<canvas id="artobject" width="@Model.Width" height="@Model.Height">
  <p>Sorry, your browser doesn't support canvas.</p>
</canvas>

<button onclick="console.log(ctx.toDataURL());">I love it! Download!</button>

<script>
  var ctx = document.getElementById('artobject').getContext('2d');
  var img1 = new Image();
  img1.onload = function () {
    ctx.drawImage(img1, 0, 0);
  };
  img1.src = '@Model.Url';
</script>


@{ int count = 0; }
@foreach (var face in uploaded.Items)
{
  int originalFaceHeight = (int)((Model.Items[count].Height / 100.0) * (double)Model.Height);
  int originalFaceWidth = (int)((Model.Items[count].Width / 100.0) * (double)Model.Width);
  int overlayFaceHeight = (int)((face.Height / 100.0) * (double)uploaded.Height);
  int overlayFaceWidth = (int)((face.Width / 100.0) * (double)uploaded.Width);
  var center = Model.Items[count].Center;
  int left = (int)((center.x / 100.0) * Model.Width) - (originalFaceWidth / 2);
  int top = (int)((center.y / 100.0) * Model.Height) - (originalFaceHeight / 2);

  var overlayCenter = uploaded.Items[count].Center;
  int overlayLeft = (int)((overlayCenter.x / 100.0) * uploaded.Width) - (overlayFaceWidth / 2);
  int overlayTop = (int)((overlayCenter.y / 100.0) * uploaded.Height) - (overlayFaceHeight / 2);

  double ratio = (double)originalFaceHeight / (double)overlayFaceHeight;
  <script>
    var img = new Image();
    img.onload = function () {
      ctx.drawImage(img, @overlayLeft, @overlayTop, @overlayFaceWidth, @overlayFaceHeight, @left, @top, @originalFaceWidth, @originalFaceHeight);
    };
    img.src = '@uploaded.Url';
  </script>
  
  count++;
}


@*<style>
#picture
{
  -webkit-mask-image: -webkit-radial-gradient(white,transparent 50%);
}

img { position:absolute;
      top:0; left:0; }

</style>

<img src="@uploaded.Url" id="picture" />

*@